import logging

logger = logging.getLogger(__name__)

def bigquery_nl2sql(question: str) -> str:
    """自然言語の問い合わせからSQLクエリを生成する

    Args:
        question (str): 自然言語の質問

    Returns:
        str: 質問に回答するために生成されたSQL
    """
    logger.debug("bigquery_nl2sql - question: %s", question)

    prompt_template = """
あなたはBigQuery SQLの専門家で、ユーザーの自然言語の質問に基づいて
Google SQL方言でSQLを生成する任務を担っています。
提供されたコンテキストを使用しながら、以下の質問に答えるBigquery SQLクエリを
作成することがあなたのタスクです。

**ガイドライン:**

- **テーブル参照:** SQL文では常にデータベースプレフィックス付きの完全なテーブル名を
使用してください。テーブルはバッククォート(`)で囲まれた完全修飾名を使用して
参照する必要があります。例: `project_name.dataset_name.table_name`
テーブル名は大文字小文字を区別します。
- **結合:** できるだけ少ないテーブルを結合してください。テーブルを結合する際は、
すべての結合列が同じデータ型であることを確認してください。データベースと
テーブルスキーマを分析して、列とテーブル間の関係を理解してください。
- **集約:** `SELECT`文のすべての非集約列を`GROUP BY`句に含めてください。
- **SQL構文:** プロパティマッピング（project_id、owner、table、column関係）が
正しいBigQuery用の構文的および意味的に正しいSQLを返してください。必要に応じて
SQL `AS`文を使用して、テーブル列やテーブル自体に一時的に新しい名前を割り当てて
ください。サブクエリとUNIONクエリは常に括弧で囲んでください。
- **列の使用:** テーブルスキーマに記載されている列名（column_name）*のみ*を
使用してください。他の列名は使用*しないで*ください。テーブルスキーマに記載されて
いる`column_name`は、テーブルスキーマで指定された`table_name`のみに関連付けて
ください。
- **フィルター:** 返される総行数を削減・最小化するために、効果的にクエリを記述
する必要があります。例えば、SQLクエリでフィルター（`WHERE`、`HAVING`など）や
集約関数（'COUNT'、'SUM'など）を使用できます。
- **行数制限:** 返される行の最大数は{MAX_NUM_ROWS}未満である必要があります。

**スキーマ:**

データベース構造は以下のテーブルスキーマ（サンプル行を含む可能性あり）によって
定義されています:

{SCHEMA}

**自然言語の質問:**

{QUESTION}

**段階的に考えてください:** 上記で概説されたスキーマ、質問、ガイドライン、
ベストプラクティスを慎重に検討して、正しいBigQuery SQLを生成してください。

   """
    return "SELECT * FROM example_table LIMIT 10;"